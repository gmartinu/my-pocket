# üí∞ App Controle Financeiro

App mobile para controle de gastos mensais com workspaces compartilh√°veis. Feito para casal gerenciar finan√ßas de forma independente ou conjunta.

## üéØ Objetivo

Replicar sistema de planilha para controle de:
- Despesas fixas e vari√°veis (com status pago/n√£o pago)
- Cart√µes de cr√©dito com parcelas
- Proje√ß√£o de saldo para pr√≥ximos meses
- Workspaces independentes e compartilh√°veis

## üõ†Ô∏è Stack

- **Frontend**: React Native (Expo)
- **Backend**: Firebase (Auth + Firestore)
- **Navega√ß√£o**: React Navigation
- **State**: Context API + React Hooks
- **UI**: React Native Paper ou NativeWind (Tailwind)
- **Formul√°rios**: React Hook Form (opcional)

## üèóÔ∏è Arquitetura Firebase

### Firestore Structure
```
/users/{userId}
  - name: string
  - email: string
  - workspaces: string[]
  - activeWorkspace: string
  - createdAt: timestamp

/workspaces/{workspaceId}
  - name: string
  - owner: userId
  - members: [{userId, role}]
  - createdAt: timestamp
  
  /months/{monthId}  // monthId = "2025-10"
    - nome: string
    - ano: number
    - mes: number
    - saldoInicial: number
    - despesas: [
        {
          id: string,
          nome: string,
          valorPlanejado: string | number,
          pago: boolean,
          valorCalculado: number
        }
      ]
    - cartoes: [
        {
          id: string,
          nome: string,
          limiteTotal: number,
          compras: [
            {
              id: string,
              descricao: string,
              valorTotal: number,
              parcelaAtual: number,
              parcelasTotal: number,
              marcado: boolean
            }
          ]
        }
      ]
    - totalDespesas: number
    - totalCartoes: number
    - sobra: number
    - updatedAt: timestamp
```

### Security Rules
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read, write: if request.auth.uid == userId;
    }
    
    match /workspaces/{workspaceId} {
      function isMember() {
        return request.auth.uid in resource.data.members[0].userId;
      }
      
      allow read: if request.auth != null && isMember();
      allow write: if request.auth != null && isMember();
      
      match /months/{monthId} {
        allow read, write: if request.auth != null && 
          get(/databases/$(database)/documents/workspaces/$(workspaceId)).data.members[0].userId == request.auth.uid;
      }
    }
  }
}
```

## üìÅ Estrutura de Pastas

```
src/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ firebase.js              # Configura√ß√£o Firebase
‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.js           # Autentica√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ WorkspaceContext.js      # Workspace ativo
‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginScreen.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RegisterScreen.js
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DashboardScreen.js   # Tela principal com resumo
‚îÇ   ‚îú‚îÄ‚îÄ despesas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DespesasScreen.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DespesaFormModal.js
‚îÇ   ‚îú‚îÄ‚îÄ cartoes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CartoesScreen.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CompraFormModal.js
‚îÇ   ‚îú‚îÄ‚îÄ workspaces/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WorkspacesScreen.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ShareWorkspaceModal.js
‚îÇ   ‚îî‚îÄ‚îÄ settings/
‚îÇ       ‚îî‚îÄ‚îÄ SettingsScreen.js
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ DespesaCard.js
‚îÇ   ‚îú‚îÄ‚îÄ CartaoCard.js
‚îÇ   ‚îú‚îÄ‚îÄ MonthSelector.js
‚îÇ   ‚îî‚îÄ‚îÄ WorkspaceSelector.js
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.js
‚îÇ   ‚îú‚îÄ‚îÄ useWorkspace.js
‚îÇ   ‚îî‚îÄ‚îÄ useMonth.js
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ calculations.js          # C√°lculos (f√≥rmulas, totais)
‚îÇ   ‚îî‚îÄ‚îÄ validators.js
‚îî‚îÄ‚îÄ navigation/
    ‚îú‚îÄ‚îÄ AppNavigator.js
    ‚îî‚îÄ‚îÄ AuthNavigator.js
```

## üöÄ Fases de Desenvolvimento

### **FASE 1: Setup e Autentica√ß√£o** 
**Objetivo**: Projeto rodando com login funcional

**Tarefas**:
- [ ] Criar projeto Expo com TypeScript (opcional)
- [ ] Configurar Firebase (Auth + Firestore)
- [ ] Criar telas de Login/Registro
- [ ] Implementar AuthContext
- [ ] Navega√ß√£o b√°sica (Auth vs App)

**Entreg√°vel**: Login com email/senha funcionando

---

### **FASE 2: Workspaces Base**
**Objetivo**: Criar e listar workspaces

**Tarefas**:
- [ ] WorkspaceContext
- [ ] Tela de listagem de workspaces
- [ ] Criar novo workspace (autom√°tico no primeiro login)
- [ ] Selecionar workspace ativo
- [ ] Firestore: CRUD de workspaces

**Entreg√°vel**: Usu√°rio pode ter m√∫ltiplos workspaces

---

### **FASE 3: Meses e Dashboard**
**Objetivo**: Dashboard com resumo mensal

**Tarefas**:
- [ ] useMonth hook (criar, buscar, atualizar m√™s)
- [ ] DashboardScreen com resumo:
  - Saldo dispon√≠vel
  - Total despesas
  - Sobra prevista
  - Proje√ß√£o pr√≥ximos meses
- [ ] MonthSelector (navegar entre meses)
- [ ] Criar m√™s se n√£o existir

**Entreg√°vel**: Dashboard mostrando resumo do m√™s atual

---

### **FASE 4: Despesas CRUD**
**Objetivo**: Adicionar, editar e marcar despesas

**Tarefas**:
- [ ] DespesasScreen (lista)
- [ ] DespesaCard com toggle pago/n√£o pago
- [ ] DespesaFormModal (adicionar/editar)
- [ ] Suporte a f√≥rmulas simples (475.11/2+650)
- [ ] C√°lculo autom√°tico de totais
- [ ] Excluir despesa (swipe)

**Entreg√°vel**: CRUD completo de despesas funcionando

---

### **FASE 5: Cart√µes de Cr√©dito**
**Objetivo**: Gerenciar cart√µes e compras parceladas

**Tarefas**:
- [ ] CartoesScreen (lista de cart√µes)
- [ ] CartaoCard (expandir/colapsar compras)
- [ ] CompraFormModal (adicionar compra parcelada)
- [ ] C√°lculo de parcela autom√°tico
- [ ] Total da fatura por cart√£o
- [ ] Editar/Excluir compra

**Entreg√°vel**: Sistema de cart√µes completo

---

### **FASE 6: Compartilhamento**
**Objetivo**: Compartilhar workspace entre usu√°rios

**Tarefas**:
- [ ] ShareWorkspaceModal
- [ ] Buscar usu√°rio por email
- [ ] Adicionar membro ao workspace
- [ ] Definir roles (owner/editor/viewer)
- [ ] Atualizar security rules
- [ ] Notifica√ß√£o de compartilhamento (opcional)

**Entreg√°vel**: Gabriel pode compartilhar com Eloane

---

### **FASE 7: Sincroniza√ß√£o em Tempo Real**
**Objetivo**: Updates autom√°ticos entre dispositivos

**Tarefas**:
- [ ] Implementar onSnapshot no useMonth
- [ ] Listener de mudan√ßas no workspace ativo
- [ ] Feedback visual de sincroniza√ß√£o
- [ ] Resolver conflitos (last-write-wins)

**Entreg√°vel**: Mudan√ßas aparecem em tempo real

---

### **FASE 8: Polimento e Extras**
**Objetivo**: UX melhorada e features extras

**Tarefas**:
- [ ] Tela de configura√ß√µes do m√™s (editar saldo inicial)
- [ ] Hist√≥rico de meses anteriores (read-only ou edit√°vel)
- [ ] Gr√°ficos (opcional - Victory Native)
- [ ] Dark mode
- [ ] Exportar m√™s como PDF (opcional)
- [ ] Cache offline (AsyncStorage)
- [ ] Loading states e error handling
- [ ] Anima√ß√µes (Reanimated)

**Entreg√°vel**: App polido e pronto pra uso

---

## üîß Setup Inicial

### 1. Criar projeto
```bash
npx create-expo-app@latest controle-financeiro --template blank
cd controle-financeiro
```

### 2. Instalar depend√™ncias
```bash
# Firebase
npx expo install firebase

# Navega√ß√£o
npx expo install @react-navigation/native @react-navigation/native-stack @react-navigation/bottom-tabs
npx expo install react-native-screens react-native-safe-area-context

# UI (escolher uma)
npx expo install react-native-paper react-native-vector-icons
# OU
npx expo install nativewind tailwindcss
```

### 3. Configurar Firebase
1. Criar projeto no [Firebase Console](https://console.firebase.google.com)
2. Adicionar app Web
3. Habilitar Authentication (Email/Password e Google)
4. Criar Firestore Database
5. Copiar config para `src/config/firebase.js`

### 4. Estrutura base do firebase.js
```javascript
import { initializeApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: "...",
  authDomain: "...",
  projectId: "...",
  storageBucket: "...",
  messagingSenderId: "...",
  appId: "..."
};

const app = initializeApp(firebaseConfig);
export const auth = getAuth(app);
export const db = getFirestore(app);
```

## üì± Fluxos Principais

### Login ‚Üí Dashboard
```
LoginScreen 
  ‚Üí AuthContext.login()
  ‚Üí Firebase Auth
  ‚Üí Criar/Buscar workspace padr√£o
  ‚Üí WorkspaceContext.setActive()
  ‚Üí DashboardScreen
```

### Adicionar Despesa
```
DashboardScreen 
  ‚Üí "Adicionar Despesa"
  ‚Üí DespesaFormModal
  ‚Üí useMonth.addDespesa()
  ‚Üí Firestore update
  ‚Üí Listener atualiza UI
```

### Toggle Pago/N√£o Pago
```
DespesaCard
  ‚Üí onToggle()
  ‚Üí useMonth.updateDespesa(id, {pago: !pago})
  ‚Üí Recalcula totais
  ‚Üí Firestore update
  ‚Üí UI atualiza
```

## üé® Decis√µes de Design

### Cores Sugeridas
- ‚úÖ Verde (#10B981): Positivo, pago, sobra
- ‚ùå Vermelho (#EF4444): Negativo, pendente, alerta
- üîµ Azul (#3B82F6): Neutro, informa√ß√£o
- ‚ö™ Cinza (#6B7280): Desabilitado, n√£o pago

### Componentes Principais
1. **DespesaCard**: Swipeable, toggle visual, valor destacado
2. **CartaoCard**: Accordion com lista de compras, barra de limite
3. **MonthSelector**: Horizontal scroll ou dropdown
4. **WorkspaceSelector**: Dropdown no header

## üìä C√°lculos Importantes

### Total de Despesas
```javascript
const calcularTotalDespesas = (despesas) => {
  return despesas
    .filter(d => d.pago)
    .reduce((sum, d) => sum + d.valorCalculado, 0);
};
```

### Avaliar F√≥rmula
```javascript
const avaliarFormula = (valor) => {
  if (typeof valor === 'number') return valor;
  try {
    // Remove espa√ßos e avalia express√£o segura
    return Function('"use strict"; return (' + valor + ')')();
  } catch {
    return 0;
  }
};
```

### Sobra do M√™s
```javascript
const sobra = saldoInicial - totalDespesas - totalCartoes;
```

### Proje√ß√£o Pr√≥ximos Meses
```javascript
// Sobra do m√™s atual vira saldo inicial do pr√≥ximo
proximoMes.saldoInicial = mesAtual.sobra;
```

## üîê Seguran√ßa

- ‚úÖ Nunca expor Firebase config em reposit√≥rio p√∫blico
- ‚úÖ Usar vari√°veis de ambiente (expo-constants)
- ‚úÖ Validar inputs antes de salvar
- ‚úÖ Security rules do Firestore restritivas
- ‚úÖ Sanitizar f√≥rmulas antes de avaliar

## üìù Conven√ß√µes

- Componentes em PascalCase
- Hooks com prefixo `use`
- Contextos com sufixo `Context`
- Constantes em UPPER_SNAKE_CASE
- Async functions com try/catch
- Loading e error states sempre

## üêõ Debug

```javascript
// Habilitar logs Firebase
import { setLogLevel } from 'firebase/firestore';
setLogLevel('debug');

// React Native Debugger
// CMD+D (iOS) / CMD+M (Android) ‚Üí Debug
```

## üìö Recursos

- [Expo Docs](https://docs.expo.dev)
- [Firebase Docs](https://firebase.google.com/docs)
- [React Navigation](https://reactnavigation.org)
- [React Native Paper](https://callstack.github.io/react-native-paper/)

## üö¢ Deploy

```bash
# Build Android
eas build --platform android

# Build iOS
eas build --platform ios

# Publicar update OTA
eas update --branch production
```

---

**Criado para uso pessoal de Gabriel e Eloane** üíö
